<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- HEAVILY INSPIRED FROM https://bl.ocks.org/d3noob/013054e8d7807dff76247b81b0e29030 by Malcolm Maclean
    NEED TO CHECK similarities and how it looks like
    -->

    <!-- Load d3.js -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <!-- Load the sankey.js function-->
    <script src="https://unpkg.com/d3-sankey@0.12.3/dist/d3-sankey.min.js"></script>
    
    <!-- Create a div where the graph will take place -->
    <div id="world_viz_1" style="max-width: 900px;"></div>
    
    <!-- Add style to links -->
    <link rel="stylesheet" href="sankey.css"> 

    
</head>

<body>

    <script>
        // dimension and margin of graph
        var margin = {top:10, right:10, bottom:10, left:200},
            width = 900 - margin.left - margin.right,
            height = 700 - margin.top - margin.bottom;

        //format variable
        var formatNumber = d3.format(",.0f") // zero decimal places
            format = function(d) {return formatNumber(d);},
            color = d3.scaleOrdinal(d3.schemeCategory10);

        // append the svg object to the body of the page
        var svg = d3.select("body").append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
            .append("g")
                .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

        // set the sankey diagram properties
        var sankey = d3.sankey()
            .nodeWidth(20)
            .nodePadding(10)
            .size([width, height])

        var path = sankey.links();

        // load the data
        d3.json("../data_world/sankey_2020_continent_test.json").then(function(sankeydata){
            graph = sankey(sankeydata);

        // add the links
        var link = svg.append("g").selectAll(".link")
            .data(graph.links)
            .enter().append("path")
                .attr("class", "link")
                .attr("d", d3.sankeyLinkHorizontal())
                .attr("stroke-width", function(d) {return d.width});

        // add the link titles that appear when hovering on the links
        link.append("title")
            .text(function(d) {
                return "from " + d.source.name + " to " + d.target.name + "\n" + format(d.value);
            });

        // add in the nodes
        var node = svg.append("g").selectAll(".node")
            .data(graph.nodes)
            .enter().append("g")
            .attr("class", "node");

        // add the rectangles for the nodes 
        node.append("rect")
            .attr("x", function(d) {return d.x0;})
            .attr("y", function(d) {return d.y0;})
            .attr("height", function(d) {return d.y1 - d.y0; })
            .attr("width", sankey.nodeWidth())
            .style("fill", function(d) {
                                return d.color = color(d.name.replace(/ .*/, "")); })
            .style("stroke", function(d) {
                                return d3.rgb(d.color).darker(2); })
            .append("title")
                .text(function(d) {
                            return d.name + "\n" + format(d.value); })

        // add the titles for the nodes
        node.append("text")
            .attr("x", function(d) {return d.x0-6;})
            .attr("y", function(d) {return (d.y1 + d.y0)/ 2;})
            .attr("dy", "0.35em")
            .attr("text-anchor", "end")
            .text(function(d) {return d.name;})
         .filter(function(d) {return d.x0 < width/2;})
            .attr("x", function(d) {return dx1 + 6;})
            .attr("text-anchor", "start")
        });

    </script>
</body>
</html>