<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">


<!-- Load d3.js -->
<script src="https://d3js.org/d3.v6.js"></script>
<!-- NEEDS TO BE REMOVED LATER, very ugly fix of local access problem -->
<script type='text/javascript' src='../data_world/united_data.js'></script>

<!-- Create a div where the graph will take place -->
<div id="my_dataviz" style="max-width: 900px;"></div>

<style>
  .circle:hover{
    stroke: black;
    stroke-width: 4px;
  }
</style>

<script>
    
    // set width and height of svg
    const width = 1000
    const height = 750
    const aspect = 1.5 // width/height

    // Source: https://brendansudol.github.io/writing/responsive-d3

    function responsivefy(svg) {
      // get container + svg aspect ratio
      var container = d3.select(svg.node().parentNode),
          width = parseInt(svg.style("width")),
          height = parseInt(svg.style("height")),
          aspect = width / height;
  
      // add viewBox and preserveAspectRatio properties,
      // and call resize so that svg resizes on inital page load
      svg.attr("viewBox", "0 0 " + width + " " + height)
          .attr("perserveAspectRatio", "xMinYMid")
          .call(resize);
  
      // to register multiple listeners for same event type, 
      // you need to add namespace, i.e., 'click.foo'
      // necessary if you call invoke this function for multiple svgs
      // api docs: https://github.com/mbostock/d3/wiki/Selections#on
      d3.select(window).on("resize." + container.attr("id"), resize);
  
      // get width of container and resize svg to fit it
      function resize() {
          var targetWidth = parseInt(container.style("width"));
          svg.attr("width", targetWidth);
          svg.attr("height", Math.round(targetWidth / aspect));
      }
  }
    
    // The svg
    const svg = d3.select("#my_dataviz")
      .append("svg")
      .attr("width", width)
      .attr("height", height)
      .call(responsivefy)
      //.attr("viewBox", "0 0 1200 700")
      //.attr("perserveAspectRatio", "xMinYMid")
    
    // Map and projection
    const projection = d3.geoMercator()
        //.center([4, 47])                // GPS of location to zoom on
        //.scale(800)                       // This is like the zoom
        .translate([ width/2, height/2 ])
    
    // Create data for circles:
    const markers = [
      {long: 9.083, lat: 42.149, name: "Corsica"}, // corsica
      {long: 7.26, lat: 43.71, name: "Nice"}, // nice
      {long: 2.349, lat: 48.864, name: "Paris"}, // Paris
      {long: -1.397, lat: 43.664, name: "Hossegor"}, // Hossegor
      {long: 3.075, lat: 50.640, name: "Lille"}, // Lille
      {long: -3.83, lat: 58, name: "Morlaix"}, // Morlaix
    ];

    // Load external data and boot
    d3.json("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson").then( function(data){
    
        // Filter data
        // data.features = data.features.filter( d => d.properties.name=="France")


    
        // Draw the map
        svg.append("g")
            .selectAll("path")
            .data(data.features)
            .join("path")
              .attr("fill", "#b8b8b8")
              .attr("d", d3.geoPath()
                  .projection(projection)
              )
            .style("stroke", "black")
            .style("opacity", .3)
    
        // create a tooltip
        const Tooltip = d3.select("#my_dataviz")
          .append("div")
          .attr("class", "tooltip")
          .style("opacity", 1)
          .style("background-color", "white")
          .style("border", "solid")
          .style("border-width", "2px")
          .style("border-radius", "5px")
          .style("padding", "5px")
    
        // Three function that change the tooltip when user hover / move / leave a cell
        const mouseover = function(event, d) {
          Tooltip.style("opacity", 1)
        }
        var mousemove = function(event, d) {
          Tooltip
            .html(d.name + "<br>" + "long: " + d.long + "<br>" + "lat: " + d.lat)
            .style("left", (event.x)/2 + "px")
            .style("top", (event.y)/2 - 30 + "px")
        }
        var mouseleave = function(event, d) {
          Tooltip.style("opacity", 0)
        }
    
        // Add circles:
        svg
          .selectAll("myCircles")
          .data(united)
          .join("circle")
            .attr("cx", d => projection([d.long, d.lat])[0])
            .attr("cy", d => projection([d.long, d.lat])[1])
            .attr("r", 4)
            .attr("class", "circle")
            .style("fill", "69b3a2")
            .attr("stroke", "#69b3a2")
            .attr("stroke-width", 1 )
            .attr("fill-opacity", .4)
          .on("mouseover", mouseover)
          .on("mousemove", mousemove)
          .on("mouseleave", mouseleave)
    
    })

    window.addEventListener('resize', resize);
    
    function resize() {
      // Obtain new dimensions
      const newWidth = parseInt(svg.style('width'));
      const newHeight = parseInt(svg.style('height'));
      // Update scales
      xScale.range([0, newWidth]);
      yScale.range([newHeight, 0]);
      // Update axes
      svg.select('.x-axis').call(d3.axisBottom(xScale));
      svg.select('.y-axis').call(d3.axisLeft(yScale));
      // Redraw other chart elements accordingly
    }

    
    </script>